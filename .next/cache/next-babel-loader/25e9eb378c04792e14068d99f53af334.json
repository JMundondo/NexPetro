{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.default = initHeadManager;\n\nvar _react = require(\"react\");\n\nconst DOMAttributeNames = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv'\n};\n\nfunction reactElementToDOM(_ref) {\n  let {\n    type,\n    props\n  } = _ref;\n  const el = document.createElement(type);\n\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue;\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue; // we don't render undefined props to the DOM\n\n    if (props[p] === undefined) continue;\n    const attr = DOMAttributeNames[p] || p.toLowerCase();\n    el.setAttribute(attr, props[p]);\n  }\n\n  const {\n    children,\n    dangerouslySetInnerHTML\n  } = props;\n\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || '';\n  } else if (children) {\n    el.textContent = typeof children === 'string' ? children : Array.isArray(children) ? children.join('') : '';\n  }\n\n  return el;\n}\n\nfunction updateElements(elements, components, removeOldTags) {\n  const headEl = document.getElementsByTagName('head')[0];\n  const oldTags = new Set(elements);\n  components.forEach(tag => {\n    if (tag.type === 'title') {\n      let title = '';\n\n      if (tag) {\n        const {\n          children\n        } = tag.props;\n        title = typeof children === 'string' ? children : Array.isArray(children) ? children.join('') : '';\n      }\n\n      if (title !== document.title) document.title = title;\n      return;\n    }\n\n    const newTag = reactElementToDOM(tag);\n    const elementIter = elements.values();\n\n    while (true) {\n      // Note: We don't use for-of here to avoid needing to polyfill it.\n      const {\n        done,\n        value\n      } = elementIter.next();\n\n      if (value == null ? void 0 : value.isEqualNode(newTag)) {\n        oldTags.delete(value);\n        return;\n      }\n\n      if (done) {\n        break;\n      }\n    }\n\n    elements.add(newTag);\n    headEl.appendChild(newTag);\n  });\n  oldTags.forEach(oldTag => {\n    if (removeOldTags) {\n      oldTag.parentNode.removeChild(oldTag);\n    }\n\n    elements.delete(oldTag);\n  });\n}\n\nfunction initHeadManager(initialHeadEntries) {\n  const headEl = document.getElementsByTagName('head')[0];\n  const elements = new Set(headEl.children);\n  updateElements(elements, initialHeadEntries.map(_ref2 => {\n    let [type, props] = _ref2;\n    return /*#__PURE__*/(0, _react.createElement)(type, props);\n  }), false);\n  let updatePromise = null;\n  return {\n    mountedInstances: new Set(),\n    updateHead: head => {\n      const promise = updatePromise = Promise.resolve().then(() => {\n        if (promise !== updatePromise) return;\n        updatePromise = null;\n        updateElements(elements, head, true);\n      });\n    }\n  };\n}","map":{"version":3,"sources":["../../client/head-manager.ts"],"names":["DOMAttributeNames","acceptCharset","className","htmlFor","httpEquiv","el","document","props","p","attr","dangerouslySetInnerHTML","Array","children","headEl","oldTags","tag","title","newTag","reactElementToDOM","elementIter","elements","value","oldTag","updateElements","initialHeadEntries","updatePromise","mountedInstances","updateHead","head","promise","Promise"],"mappings":"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","sourcesContent":["import { createElement } from 'react'\nimport { HeadEntry } from '../next-server/lib/utils'\n\nconst DOMAttributeNames: Record<string, string> = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv',\n}\n\nfunction reactElementToDOM({ type, props }: JSX.Element): HTMLElement {\n  const el = document.createElement(type)\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue\n\n    // we don't render undefined props to the DOM\n    if (props[p] === undefined) continue\n\n    const attr = DOMAttributeNames[p] || p.toLowerCase()\n    el.setAttribute(attr, props[p])\n  }\n\n  const { children, dangerouslySetInnerHTML } = props\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || ''\n  } else if (children) {\n    el.textContent =\n      typeof children === 'string'\n        ? children\n        : Array.isArray(children)\n        ? children.join('')\n        : ''\n  }\n  return el\n}\n\nfunction updateElements(\n  elements: Set<Element>,\n  components: JSX.Element[],\n  removeOldTags: boolean\n) {\n  const headEl = document.getElementsByTagName('head')[0]\n  const oldTags = new Set(elements)\n\n  components.forEach((tag) => {\n    if (tag.type === 'title') {\n      let title = ''\n      if (tag) {\n        const { children } = tag.props\n        title =\n          typeof children === 'string'\n            ? children\n            : Array.isArray(children)\n            ? children.join('')\n            : ''\n      }\n      if (title !== document.title) document.title = title\n      return\n    }\n\n    const newTag = reactElementToDOM(tag)\n    const elementIter = elements.values()\n\n    while (true) {\n      // Note: We don't use for-of here to avoid needing to polyfill it.\n      const { done, value } = elementIter.next()\n      if (value?.isEqualNode(newTag)) {\n        oldTags.delete(value)\n        return\n      }\n\n      if (done) {\n        break\n      }\n    }\n\n    elements.add(newTag)\n    headEl.appendChild(newTag)\n  })\n\n  oldTags.forEach((oldTag) => {\n    if (removeOldTags) {\n      oldTag.parentNode!.removeChild(oldTag)\n    }\n    elements.delete(oldTag)\n  })\n}\n\nexport default function initHeadManager(initialHeadEntries: HeadEntry[]) {\n  const headEl = document.getElementsByTagName('head')[0]\n  const elements = new Set<Element>(headEl.children)\n\n  updateElements(\n    elements,\n    initialHeadEntries.map(([type, props]) => createElement(type, props)),\n    false\n  )\n\n  let updatePromise: Promise<void> | null = null\n\n  return {\n    mountedInstances: new Set(),\n    updateHead: (head: JSX.Element[]) => {\n      const promise = (updatePromise = Promise.resolve().then(() => {\n        if (promise !== updatePromise) return\n\n        updatePromise = null\n        updateElements(elements, head, true)\n      }))\n    },\n  }\n}\n"]},"metadata":{},"sourceType":"script"}